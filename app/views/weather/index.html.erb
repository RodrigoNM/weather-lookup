<h1>Weather Lookup</h1>

<div class="weather-container">
  <div class="form-column">
    <%= form_with url: show_weather_path, method: :get do |form| %>
      <%= form.label :zip_code, 'Enter ZIP code' %>
      <%= form.text_field :zip_code, value: params[:zip_code], required: true %>
      <%= form.submit 'Get Weather' %>
    <% end %>
  </div>

  <div class="results-column">
    <% if flash[:error] %>
      <p style="color: red"><%= flash[:error] %></p>
    <% end %>

    <% if @weather %>
      <% if @weather[:from_cache] %>
        <p><em>(Data was fetched from cache, <%= @weather[:remaining_time] %> minutes left)</em></p>
      <% else %>
        <p><em>(Data was fetched from the API)</em></p>
      <% end %>

      <h2>Weather for <%= params[:zip_code] %></h2>
      
      <% if @weather[:error] %>
        <p style="color: red"><%= @weather[:error] %></p>
      <% else %>
        <div class="weather-details">
          <p>
            <strong>Condition:</strong> 
            <%= @weather[:current_weather][:condition_text] %>
            <%= image_tag("https:#{@weather[:current_weather][:condition_icon]}", alt: @weather[:current_weather][:condition_text], class: "condition-icon") %> 
          </p>
          <p><strong>Temperature:</strong> <%= @weather[:current_weather][:temp_f] %>°F / <%= @weather[:current_weather][:temp_c] %>°C</p>
          <p><strong>Feels Like:</strong> <%= @weather[:current_weather][:feelslike_f] %>°F / <%= @weather[:current_weather][:feelslike_c] %>°C</p>
          <p><strong>High:</strong> <%= @weather[:current_weather][:max_temp_f] %>°F / <%= @weather[:current_weather][:max_temp_c] %>°C</p>
          <p><strong>Low:</strong> <%= @weather[:current_weather][:min_temp_f] %>°F / <%= @weather[:current_weather][:min_temp_c] %>°C</p>
          <p><strong>Wind Speed:</strong> <%= @weather[:current_weather][:wind_mph] %> mph / <%= @weather[:current_weather][:wind_kph] %> kph</p>
          <p><strong>Humidity:</strong> <%= @weather[:current_weather][:humidity] %>%</p>
        </div>

        <h3>Extended Forecast</h3>
        <ul>
          <% @weather[:forecast].each do |day| %>
            <li>
              <strong><%= day[:date] %>:</strong> 
              <%= day[:condition_text] %> 
              (High: <%= day[:max_temp_f] %>°F / <%= day[:max_temp_c] %>°C, Low: <%= day[:min_temp_f] %>°F / <%= day[:min_temp_c] %>°C)
              <%= image_tag("https:#{day[:condition_icon]}", alt: day[:condition_text]) %>
            </li>
          <% end %>
        </ul>
      <% end %>
    <% end %>
  </div>
</div>
